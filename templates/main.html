<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Storage Folders</title>

    <style>
        body {
            margin: 0;
            padding: 0px;
            background-image: url('background3.png'); /* Replace with your background image path */
            background-size: cover;
            background-position: center;
            font-family: Arial, sans-serif;
            height: 100vh; /* Ensure the body takes up the full height of the viewport */
        }

        header {
            background-color: #21323D;
            color: #FFFFFF;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            width: 100%;
            z-index: 1; /* Ensure the header is on top of other elements */
            padding-top: 0px; /* Adds top padding */
            padding-bottom: 0px; /* Adds bottom padding */
            padding-left: 0px; /* Adds left padding */
            padding-right: px; /* Adds right padding */
        }

        header a {
            color: #FFFFFF;
            text-decoration: none;
            margin:  15px;
            display: flex;
            align-items: center;
        }



        #folder-input-div {
            font-size: 18px;
            color: white;
            position: absolute;
            left: 40%;
            right: 45%;
            top: 30%; /* Adjust vertically based on your preference */
            transform: translateY(-50%); /* Center vertically */
            margin: auto;
            width: 100%;
        }

        #matching-folders {
            list-style-type: none;
            padding: 0;
        }

        #matching-folders li {
            margin: 5px 0;
        }


        #folder-input {
            margin-top: 20vh; /* Center the input vertically */
            font-size: 18px;
            background-color: #526774;
            color: #FFFFFF;
            padding-left: 30px; /* Adjust left padding for the icon */
            color: white;
            padding-right: 20px; /* Adjust as needed to leave space for the smaller icon */
            background-image: url('search_icon.png');
            background-repeat: no-repeat;
            background-position: center right 8px; /* Adjust the position of the icon */
            background-size: 16px; /* Set the size of the icon */

        }
        #folder-input::placeholder {
        color: white;
        }

        #folder-input::before {
        content: url('search_icon.png');
        width: 20px; /* Set the width of the icon */
        height: 20px; /* Set the height of the icon */
        position: absolute;
        left: 10px;
        top: 50%;
        transform: translateY(-50%);
        }

    </style>
</head>
<body>

    <!-- Header -->
    <header>
        <!-- Left side -->
        <div style="display: flex; align-items: center;">
            <!-- Logo -->
            <img src="logo1.png" alt="Logo" height="60" style="margin:15px;">
            <!-- Home page link with icon -->
            <a href="main.html" id="home-link"><img src="home.png" alt="Home" height="20" style="margin-right: 10px;"> Home</a>
            <!-- Report page link with icon -->
            <a href="reports.html" id="report-link"><img src="report.png" alt="Report" height="20" style="margin-right: 10px;"> Report</a>
        </div>
        <!-- Right side -->
        <div style="display: flex; align-items: center; margin-right: 30px;">
            <!-- Sign out link with icon -->
            <a href="#" onclick="signOut()"><img src="log-out.png" alt="Sign Out" height="30" style="margin-right: 10px;"> Sign Out</a>
        </div>

        <script>
            function signOut() {
                firebase.auth().signOut().then(function () {
                    // Sign-out successful, redirect to login page
                    window.location.replace("login.html");
                }).catch(function (error) {
                    // An error happened
                    console.error("Sign out error:", error);
                });
            }
        </script>

    </header>

    <div id="folder-input-div">
        <!-- Input field for folder name with placeholder -->
        <input type="text" id="folder-input" placeholder="Enter Ticket ID" oninput="searchFolderNames()" >

        <!-- List to display matching folder names as hyperlinks -->
        <ul id="matching-folders"></ul>
    </div>

    <!-- Include the non-module version of Firebase SDK scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.6.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.2/firebase-storage-compat.js"></script>

    <script>
        // Replace with your actual Firebase configuration
        var firebaseConfig = {
      apiKey: "AIzaSyD1L5kjuB6UYTPA8qjzepKQbLTV5BvNwC0",
      authDomain: "drone-app-e0017.firebaseapp.com",
      projectId: "drone-app-e0017",
      storageBucket: "drone-app-e0017.appspot.com",
      messagingSenderId: "768272782556",
      appId: "1:768272782556:web:92e165813acee47877d019",
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);



        // Check if the user is authenticated
        firebase.auth().onAuthStateChanged(function (user) {
            if (!user) {
                // Redirect to login page if not logged in
                window.location.replace("login.html");
            }
        });


        function searchFolderNames() {
            var folderInput = document.getElementById('folder-input');
            var matchingFoldersList = document.getElementById('matching-folders');

            var storageRef = firebase.storage().ref();

            // Get the list of items at the root of Firebase Storage
            storageRef.listAll()
                .then(function (result) {
                    // Extract folder names from the list
                    var folderNames = result.prefixes.map(function (prefix) {
                        return prefix.name;
                    });

                    // Filter folder names based on input
                    var searchTerm = folderInput.value.toLowerCase();
                    var matchingFolders = folderNames.filter(function (folderName) {
                        return folderName.toLowerCase().includes(searchTerm);
                    });

                    // Display matching folder names as hyperlinks in the list
                    displayMatchingFolders(matchingFoldersList, matchingFolders);
                })
                .catch(function (error) {
                    // Handle errors
                    console.error('Error listing items:', error);
                    alert('Error retrieving folder names. Check the console for details.');
                });
        }

        function displayMatchingFolders(container, folders) {
            // Clear existing list items
            container.innerHTML = '';

            // Create and append list items with hyperlinks for matching folder names
            folders.forEach(function (folder) {
                var listItem = document.createElement('li');
                var hyperlink = document.createElement('a');

                // Set hyperlink text and href (URL)
                hyperlink.textContent = folder;
                hyperlink.href = 'page2.html#' + encodeURIComponent(folder);

                // Append the hyperlink to the list item
                listItem.appendChild(hyperlink);

                // Append the list item to the container
                container.appendChild(listItem);
            });
        }
    </script>

</body>
</html>

